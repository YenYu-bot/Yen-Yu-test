<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>理化證道錄：波光篇</title>
    <style>
        :root {
            --primary-color: #00eaff; /* 青色真氣光芒 */
            --secondary-color: #ff3333; /* 血色/心魔光芒 */
            --bg-color: #121212; /* 深淵背景 */
            --panel-bg: rgba(20, 20, 30, 0.9);
            --border-style: 2px solid var(--primary-color);
        }

        body {
            font-family: 'Noto Serif TC', 'Microsoft JhengHei', serif;
            background-color: var(--bg-color);
            background-image: url('https://www.transparenttextures.com/patterns/black-linen.png'); /* 增加一點質感 */
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1, h2, h3 {
            text-shadow: 0 0 10px var(--primary-color);
            font-weight: bold;
        }

        h1 { margin-bottom: 10px; }

        /* 修仙風格容器 */
        .container {
            background-color: var(--panel-bg);
            border: var(--border-style);
            box-shadow: 0 0 20px rgba(0, 234, 255, 0.3);
            border-radius: 10px;
            padding: 25px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* 狀態欄 */
        .status-panel {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px dashed #555;
            padding-bottom: 15px;
        }

        .status-item {
            margin: 5px 10px;
            font-size: 1.1em;
        }

        .highlight { color: var(--primary-color); font-weight: bold; }
        .danger { color: var(--secondary-color); font-weight: bold; }

        /* 戰鬥區域 (題目顯示) */
        #battle-stage { display: none; /* 初始隱藏 */ }

        .question-box {
            font-size: 1.2em;
            margin-bottom: 25px;
            line-height: 1.6;
            border-left: 5px solid var(--secondary-color);
            padding-left: 15px;
            background: rgba(255, 51, 51, 0.1);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* 修仙按鈕 */
        .xianxia-btn {
            background: linear-gradient(to bottom, #2b2b2b, #1a1a1a);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 15px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .xianxia-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: var(--bg-color);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .xianxia-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #555;
            color: #555;
        }

        /* 道具欄 */
        .inventory-panel {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #555;
        }

        .item-btn {
            padding: 10px 15px;
            font-size: 0.9em;
            background: #333;
            border: 1px solid #FFD700; /* 金色邊框 */
            color: #FFD700;
        }

        .item-btn:hover:not(:disabled) {
            background: #FFD700;
            color: #333;
            box-shadow: 0 0 10px #FFD700;
        }

        /* 開始畫面與結算畫面 */
        #start-screen, #game-over-screen { text-align: center; }
        .big-btn { width: 100%; text-align: center; font-size: 1.3em; margin-top: 20px;}

        /* 動畫效果 */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake { animation: shake 0.5s; }

        /* 響應式調整 */
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
            .status-panel { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

    <h1>理化證道錄：波光篇</h1>

    <div id="start-screen" class="container">
        <h2>乃國中二年級修士，欲渡第二次段考天劫？</h2>
        <p>此乃「波動」與「光影」之試煉場。</p>
        <p>心魔將化為難題阻你道心。</p>
        <p>準備好燃燒你的中二魂，證得理化大道了嗎？</p>
        <button class="xianxia-btn big-btn" onclick="startGame()">吾已準備完畢，開啟試煉！</button>
        <p style="margin-top: 20px; font-size: 0.8em; color: #aaa;">(目前僅開放「練功房」無盡模式)</p>
    </div>

    <div id="battle-stage" class="container">
        <div class="status-panel">
            <div class="status-item">道號：<span class="highlight">苦命國二生</span></div>
            <div class="status-item">境界：<span id="realm-display" class="highlight">練氣期一層</span></div>
            <div class="status-item">真氣(HP)：<span id="hp-display" class="danger">100/100</span></div>
            <div class="status-item">修為(Score)：<span id="score-display" class="highlight">0</span></div>
        </div>

        <div id="question-container">
            <div id="question-text" class="question-box">
                題目載入中... 正在凝聚心魔實體...
            </div>
            <div id="options-container" class="options-grid">
                </div>
        </div>

        <div class="inventory-panel">
            <span style="align-self: center;">法寶囊：</span>
            <button id="item-heal" class="xianxia-btn item-btn" onclick="useItem('heal')">回氣丹 (剩餘: 3)</button>
            <button id="item-hint" class="xianxia-btn item-btn" onclick="useItem('hint')">洞察天眼符 (剩餘: 1)</button>
        </div>
        
        <div id="feedback-message" style="margin-top: 15px; text-align: center; font-weight: bold; min-height: 1.2em;"></div>
    </div>

    <div id="game-over-screen" class="container" style="display: none;">
        <h2 id="end-title">道心破碎！</h2>
        <p id="end-message">你的理化根基尚淺，請重新修煉。</p>
        <p>最終修為：<span id="final-score" class="highlight"></span></p>
        <p>最終境界：<span id="final-realm" class="highlight"></span></p>
        <button class="xianxia-btn big-btn" onclick="resetGame()">重塑道基，再來一次！</button>
    </div>


<script>
    // ================= 1. 遊戲資料設定 (題庫與狀態) =================

    // 遊戲狀態
    let gameState = {
        hp: 100,
        maxHp: 100,
        score: 0,
        realmLevel: 1, // 1:練氣, 2:築基, 3:金丹...
        realms: ["凡人", "練氣期", "築基期", "金丹期", "元嬰期", "化神期", "理化仙帝"],
        items: {
            heal: 3,
            hint: 1
        },
        currentQuestion: null,
        isProcessing: false // 防止快速點擊
    };

    // 題庫 (中二風化)
    // tag: sound (波動聲音), light (光學)
    const questionBank = [
        // --- 波動與聲音 ---
        {
            question: "【音波功試煉】古琴仙子撥動琴弦，發出高音與低音兩道音波刃。請問這兩道攻擊在空氣中傳播時，何種性質必定不同？",
            options: ["波速 (攻擊速度)", "頻率 (靈力震動快慢)", "振幅 (破壞力大小)", "波長 (攻擊範圍)"],
            correctIndex: 1,
            tag: "sound",
            explanation: "解說：在相同介質(空氣)中，波速相同。高低音對應的是頻率不同。"
        },
        {
            question: "【傳音入密】你試圖在真空中使用「傳音入密」之術與隊友溝通，卻發現失敗了。這是因為聲波的何種特性受阻？",
            options: ["聲波靈力不足", "聲波需要介質才能傳遞", "真空中有結界阻擋", "聲波被宇宙射線抵消了"],
            correctIndex: 1,
            tag: "sound",
            explanation: "解說：聲音是力學波，需要介質(固、液、氣)才能傳播，真空中無法傳聲。"
        },
        {
            question: "【迴音谷禁地】你在充滿瘴氣的山谷對著岩壁大喊一聲，2秒後聽到了自己的迴音回傳。已知當時聲速為 340 m/s，請問你距離岩壁多遠？",
            options: ["170 公尺", "340 公尺", "680 公尺", "無限遠"],
            correctIndex: 1,
            tag: "sound",
            explanation: "解說：聲音走了來回一趟。距離 = 速度 × (時間/2) = 340 × (2/2) = 340 公尺。"
        },
        // --- 光學 ---
        {
            question: "【靈泉幻影】你凝視著一口靈泉，發現插入水中的「斬龍劍」看起來折斷了且向上彎曲。這是受到何種光學法則的影響？",
            options: ["光的反射 (鏡花水月)", "光的折射 (空間扭曲)", "光的直線傳播 (正道之光)", "光的色散 (七彩琉璃)"],
            correctIndex: 1,
            tag: "light",
            explanation: "解說：光從水進入空氣時發生折射，偏離法線，使得物體看起來比實際位置淺（向上彎曲）。"
        },
        {
            question: "【照妖鏡】傳說中的照妖鏡能照出妖怪的原形（正立、放大、虛像）。請問這面照妖鏡的本體應為何種光學法寶？",
            options: ["平面鏡", "凹面鏡", "凸透鏡", "凹透鏡"],
            correctIndex: 2,
            tag: "light",
            explanation: "解說：能形成「正立、放大、虛像」的只有凸透鏡（當物體在焦距內時，即放大鏡原理）和凹面鏡。但通常法寶設定為透鏡居多，選項中凸透鏡最符合放大鏡的描述。"
        },
        {
            question: "【影分身之術】你在練功房的一面大平面鏡前修煉。當你以 2 m/s 的速度走向鏡子時，鏡中的「心魔分身」會以多快的速度接近你？",
            options: ["2 m/s", "4 m/s", "0 m/s", "8 m/s"],
            correctIndex: 1,
            tag: "light",
            explanation: "解說：平面鏡成像，物距等於像距。你走近 2m，像也走近 2m，兩者相對接近速度為 2+2 = 4 m/s。"
        },
         {
            question: "【光之試煉】一道紅光真氣從空氣射入一塊透明靈石中，若入射角不為零，則下列關於這道真氣變化的敘述，何者正確？",
            options: ["速度變快，波長變長", "速度變慢，頻率變小", "速度變慢，波長變短", "頻率不變，速度變快"],
            correctIndex: 2,
            tag: "light",
            explanation: "解說：光從光疏介質(空氣)進入光密介質(靈石)，速度變慢。頻率由光源決定不變。根據 v=fλ，v變小，f不變，所以波長λ變短。"
        }
    ];

    // ================= 2. 遊戲邏輯控制 =================

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('battle-stage').style.display = 'block';
        resetGameState();
        updateUI();
        nextQuestion();
    }

    function resetGameState() {
        gameState.hp = 100;
        gameState.score = 0;
        gameState.realmLevel = 1;
        gameState.items = { heal: 3, hint: 1 };
        gameState.isProcessing = false;
        updateItemButtons();
    }

    function nextQuestion() {
        gameState.isProcessing = false;
        document.getElementById('feedback-message').textContent = '';
        document.getElementById('battle-stage').classList.remove('shake');

        // 隨機抽選題目 (實際應用可以改成不重複抽選直到題庫用完)
        const randomIndex = Math.floor(Math.random() * questionBank.length);
        gameState.currentQuestion = questionBank[randomIndex];

        renderQuestion(gameState.currentQuestion);
    }

    function renderQuestion(q) {
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        
        // 加上題目類型標籤
        let typeTag = q.tag === 'sound' ? '【波動音律】' : '【光影幻術】';
        questionTextEl.innerText = typeTag + q.question;
        
        optionsContainer.innerHTML = ''; // 清空舊選項

        q.options.forEach((optionText, index) => {
            const btn = document.createElement('button');
            btn.className = 'xianxia-btn option-btn';
            btn.innerText = optionText;
            btn.dataset.index = index;
            btn.onclick = () => checkAnswer(index);
            optionsContainer.appendChild(btn);
        });
        
        // 重新啟用所有選項按鈕（為了道具效果復原）
        const optionBtns = document.querySelectorAll('.option-btn');
        optionBtns.forEach(btn => btn.disabled = false);
    }

    function checkAnswer(selectedIndex) {
        if (gameState.isProcessing) return;
        gameState.isProcessing = true;

        const correctIndex = gameState.currentQuestion.correctIndex;
        const feedbackEl = document.getElementById('feedback-message');
        const optionBtns = document.querySelectorAll('.option-btn');

        // 鎖定按鈕
        optionBtns.forEach(btn => btn.disabled = true);

        if (selectedIndex === correctIndex) {
            // 答對
            feedbackEl.innerHTML = '<span style="color: var(--primary-color)">斬殺心魔成功！修為大增！</span>';
            gainScore(100 + gameState.realmLevel * 10); // 境界越高加分越多
        } else {
            // 答錯
            feedbackEl.innerHTML = '<span style="color: var(--secondary-color)">遭到心魔反噬！真氣受損！</span>';
            takeDamage(20 + gameState.realmLevel * 5); // 境界越高扣血越多
            document.getElementById('battle-stage').classList.add('shake');
            // 標示正確答案
            optionBtns[correctIndex].style.backgroundColor = '#00eaff';
            optionBtns[correctIndex].style.color = '#000';
             // 標示錯誤答案
            optionBtns[selectedIndex].style.backgroundColor = '#ff3333';
        }

        updateUI();

        // 檢查是否死亡
        if (gameState.hp <= 0) {
            setTimeout(gameOver, 1500);
        } else {
            setTimeout(nextQuestion, 2000); // 2秒後下一題
        }
    }

    function takeDamage(amount) {
        gameState.hp = Math.max(0, gameState.hp - amount);
    }

    function gainScore(amount) {
        gameState.score += amount;
        checkRealmUp();
    }

    function checkRealmUp() {
        // 簡單的境界升級公式：每 500 分升一級
        const newLevel = Math.floor(gameState.score / 500) + 1;
        if (newLevel > gameState.realmLevel && newLevel < gameState.realms.length) {
            gameState.realmLevel = newLevel;
            gameState.hp = gameState.maxHp; // 升級回滿血
            gameState.items.heal += 1; // 升級獎勵丹藥
            document.getElementById('feedback-message').innerHTML += '<br><span style="color: gold; font-size: 1.2em;">恭喜突破境界！真氣全滿！獲得回氣丹！</span>';
            updateItemButtons();
        }
    }

    function useItem(type) {
        if (gameState.isProcessing) return;

        if (type === 'heal' && gameState.items.heal > 0) {
            gameState.hp = Math.min(gameState.maxHp, gameState.hp + 50);
            gameState.items.heal--;
            document.getElementById('feedback-message').innerHTML = '<span style="color: gold">服用回氣丹，真氣恢復了！</span>';
        } else if (type === 'hint' && gameState.items.hint > 0) {
            // 洞察天眼：刪除兩個錯誤選項
            const correctIndex = gameState.currentQuestion.correctIndex;
            const optionBtns = Array.from(document.querySelectorAll('.option-btn'));
            let wrongOptions = optionBtns.filter(btn => parseInt(btn.dataset.index) !== correctIndex);
            
            // 隨機選兩個錯誤的停用
            wrongOptions = shuffleArray(wrongOptions);
            if(wrongOptions.length > 0) wrongOptions[0].disabled = true;
            if(wrongOptions.length > 1) wrongOptions[1].disabled = true;

            gameState.items.hint--;
            document.getElementById('feedback-message').innerHTML = '<span style="color: gold">開啟洞察天眼，看破了部分虛妄！</span>';
        }
        updateUI();
        updateItemButtons();
    }

    function gameOver() {
        document.getElementById('battle-stage').style.display = 'none';
        document.getElementById('game-over-screen').style.display = 'block';

        const endTitle = document.getElementById('end-title');
        const endMessage = document.getElementById('end-message');

        if (gameState.realmLevel >= 4) {
             endTitle.innerText = "肉身雖殞，道魂不滅！";
             endMessage.innerText = "你的理化造詣已達一定境界，惜哉遭遇強敵。";
        } else {
             endTitle.innerText = "道心破碎，走火入魔！";
             endMessage.innerText = "你的理化根基尚淺，請回去翻開課本重新修煉。";
        }

        document.getElementById('final-score').innerText = gameState.score;
        document.getElementById('final-realm').innerText = gameState.realms[gameState.realmLevel];
    }

    function resetGame() {
        document.getElementById('game-over-screen').style.display = 'none';
        startGame();
    }

    // ================= 3. UI 更新輔助函數 =================

    function updateUI() {
        // HP
        const hpEl = document.getElementById('hp-display');
        hpEl.innerText = `${gameState.hp}/${gameState.maxHp}`;
        hpEl.style.color = gameState.hp < 30 ? 'var(--secondary-color)' : (gameState.hp > 70 ? 'var(--primary-color)' : '#e0e0e0');
        
        // Score & Realm
        document.getElementById('score-display').innerText = gameState.score;
        document.getElementById('realm-display').innerText = gameState.realms[gameState.realmLevel];
    }

    function updateItemButtons() {
        document.getElementById('item-heal').innerText = `回氣丹 (剩餘: ${gameState.items.heal})`;
        document.getElementById('item-heal').disabled = gameState.items.heal <= 0;
        
        document.getElementById('item-hint').innerText = `洞察天眼符 (剩餘: ${gameState.items.hint})`;
        document.getElementById('item-hint').disabled = gameState.items.hint <= 0;
    }

    // 工具函數：陣列洗牌
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

</script>
</body>
</html>
